<!doctype html>
<html lang="en" class="styleFlat style3d">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  
  <title>sightwords</title>

  <link href="http://fonts.googleapis.com/css?family=Average+Sans|EB+Garamond" rel="stylesheet" type="text/css">
  
  <style>
    body {
      background-color: #eee;
      font-family: 'Average Sans', sans-serif;
      font-size: 14px;
      overflow: hidden;
    }
    .styleFlat body {
      background-color: #fff;
    }
    .style3d body {
      background-color: #ddd;
    }
    .fontFamily-AverageSans {
      font-family: 'Average Sans', sans-serif;
    }
    .fontFamily-EBGaramond {
      font-family: 'EB Garamond', serif;
    }
    .background {
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      position: absolute;
    }
    .panel {
      /* these 6 properties center panel in parent vertically and horizontally */
      /* change TBLR values to offset from those edges */
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      margin: auto;
      
      text-align: center;
      cursor: pointer;
      
    }
    .panelShadow {
      -moz-box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.3);
      -webkit-box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.3);
      box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.3);
    }
    .styleFlat .panelShadow {
      -moz-box-shadow: none;
      -webkit-box-shadow: none;
      box-shadow: none;
    }
    .panelLabel {
      font-size: 30px;
      line-height: 50px;
      letter-spacing: 4px;
      text-transform: uppercase;
      text-align: center;
      margin: 0 auto;
      position: absolute;
      width: 100%;
    }
    .panelTop {
      opacity: 0;
      
      bottom: 85%;
      
      width: 90%;
      min-width: 200px;
      /* height: 20%; */
      
      background-color: #ed9;
      border-width: 0 2px 2px;
      border-style: solid;
      border-color: #cb7;
      border-radius: 0 0 5px 5px;
      color: #cb7;
      
      overflow: hidden;
    }
    .panelTop .panelLabel,
    .panelWord .panelLabel {
      bottom: 0;
    }
    .panelBottom {
      opacity: 0;
      
      top: 85%;
      
      width: 90%;
      min-width: 200px;
      /* height: 20%; */
      
      background-color: #9ac;
      border-width: 2px 2px 0;
      border-style: solid;
      border-color: #78a;
      border-radius: 5px 5px 0 0;
      color: #78a;
      
      overflow: hidden;
    }
    .styleMono .panelTop,
    .styleMono .panelBottom {
      background-color: #ccc;
      border-color: #aaa;
      color: #aaa;
    }
    .panelBottom .panelLabel {
      top: 0;
    }
    .panelWord {
      opacity: 0;
      
      top: 15%;
      bottom: 15%;
      
      width: 90%;
      /* height: 400px; */
      max-height: 70%;
      line-height: 350px;
      font-size: 200px;
      
      background-color: #fff;
      color: #ccc;
      border: 2px solid #bbb;
      border-radius: 10px;
    }
    .styleFlat .panelWord,
    .style3d .panelWord {
      border: none;
      background-color: transparent;
      -moz-box-shadow: none;
      -webkit-box-shadow: none;
      box-shadow: none;
    }
    .word {
      position: relative;
      height: 100%;
      width: 100%;
      
      letter-spacing: -.05em;
      white-space: nowrap;
      
      color: #000;
    }
    .loading .word {
      color: #ccc;
    }
    .style3d .word {
      /* 3d text with css3 shadows, from http://www.cssrex.com/tips-tricks/how-to-create-3d-text-using-css3 */
      color:#FFFFFF;
      text-shadow: 0 1px 0 #ccc,
        0 2px 0 #c9c9c9,
        0 3px 0 #bbb,
        0 4px 0 #b9b9b9,
        0 5px 0 #aaa,
        0 6px 1px rgba(0,0,0,.1),
        0 0 5px rgba(0,0,0,.1),
        0 1px 3px rgba(0,0,0,.3),
        0 3px 5px rgba(0,0,0,.2),
        0 5px 10px rgba(0,0,0,.25),
        0 10px 10px rgba(0,0,0,.2),
        0 20px 20px rgba(0,0,0,.15);      
    }
    .inHistory .word {
      color: #ccc;
    }
    .panelWordDetails {
      font-size: 16px;
      line-height: 20px;
      text-align: center;
      margin: 2px auto;
      position: absolute;
      width: 100%;
    
      font-family: 'Average Sans', sans-serif;
      color: #bbb;
    }
    .fontStyle-capitalize {
      text-transform: capitalize;
    }
    .fontStyle-uppercase {
      text-transform: uppercase;
    }
    .bold,
    .fontStyle-bold {
      font-weight: bold;
    }
    [unselectable="on"], a {
      /* prevent text selection in most browsers except IE 6-9 */
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;      
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0); /* prevent android and iphone browsers highlighting elements on touch */
    }
  </style>
</head>

<body class="loading">

<div class="background"></div>

<div class="panel panelWord panelShadow" unselectable="on"><div class="panelLabel panelWordDetails">helping kids learn to read</div><div class="word">sightwords</div></div>

<div class="panel panelTop panelShadow" unselectable="on"><div class="panelLabel"><!-- word details --></div></div>

<div class="panel panelBottom panelShadow" unselectable="on"><div class="panelLabel"><!-- settings --></div></div>

<!-- firefox bug animating bottom edge of top panel introduced in jQuery 1.8 -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script src="jquery.color-2.1.1.min.js" type="text/javascript"></script>
<script src="underscore-1.4.4.min.js" type="text/javascript"></script>
<script src="jquery.quickfit.js" type="text/javascript"></script>

<script type="text/javascript">

(typeof($) != 'undefined') && $(document).ready(function(){

  if (window.loadFirebugConsole){
    loadFirebugConsole();
  }

  $.fx.speeds._default = 200;
  
  
  
  var lists = [
    {
      name: 'Dolch nouns',  // Dolch word list: http://en.wikipedia.org/wiki/Dolch_word_list
      words: "apple,baby,back,ball,bear,bed,bell,bird,birthday,boat,box,boy,bread,brother,cake,car,cat,chair,chicken,children,Christmas,coat,corn,cow,day,dog,doll,door,duck,egg,eye,farm,farmer,father,feet,fire,fish,floor,flower,game,garden,girl,good-bye,grass,ground,hand,head,hill,home,horse,house,kitty,leg,letter,man,men,milk,money,morning,mother,name,nest,night,paper,party,picture,pig,rabbit,rain,ring,robin,Santa Claus,school,seed,sheep,shoe,sister,snow,song,squirrel,stick,street,sun,table,thing,time,top,toy,tree,watch,water,way,wind,window,wood".split(',')
    },
    {
      name: 'Dolch pre-primer',
      words: "a,and,away,big,blue,can,come,down,find,for,funny,go,help,here,I,in,is,it,jump,little,look,make,me,my,not,one,play,red,run,said,see,the,three,to,two,up,we,where,yellow,you".split(',')
    },
    {
      name: 'Dolch primer',
      words: "all,am,are,at,ate,be,black,brown,but,came,did,do,eat,four,get,good,have,he,into,like,must,new,no,now,on,our,out,please,pretty,ran,ride,saw,say,she,so,soon,that,there,they,this,too,under,want,was,well,went,what,white,who,will,with,yes".split(',')
    },
    {
      name: 'Dolch 1st grade',
      words: "after,again,an,any,as,ask,by,could,every,fly,from,give,giving,had,has,her,him,his,how,just,know,let,live,may,of,old,once,open,over,put,round,some,stop,take,thank,them,then,think,walk,were,when".split(',')
    },
    {
      name: 'Dolch 2nd grade',
      words: "always,around,because,been,before,best,both,buy,call,cold,does,don't,fast,first,five,found,gave,goes,green,its,made,many,off,or,pull,read,right,sing,sit,sleep,tell,their,these,those,upon,us,use,very,wash,which,why,wish,work,would,write,your".split(',')
    },
    {
      name: 'Dolch 3rd grade',
      words: "about,better,bring,carry,clean,cut,done,draw,drink,eight,fall,far,full,got,grow,hold,hot,hurt,if,keep,kind,laugh,light,long,much,myself,never,only,own,pick,seven,shall,show,six,small,start,ten,today,together,try,warm".split(',')
    },
    {
      name: 'Advanced',
      words: "alabaster,alligator,animal,asteroid,aunt,backhoe,bandage,basketball,beautiful,bicycle,blanket,blizzard,blue,breakdance,broccoli,brother,bulldozer,bumblebee,cabinet,calculator,cantaloupe,captain,castle,caterpillar,caution,ceiling,chicken,chocolate,circle,classroom,computer,constellation,conundrum,cousin,crack,crash,crocodile,crunch,cucumber,dolphin,dragon,drawer,eagle,earthquake,earthworm,elbow,elephant,engine,evergreen,fountain,fragile,friend,grandfather,grandmother,hazard,hexagon,hurricane,icicle,jumprope,Jupiter,kangaroo,keyboard,knee,knight,knock,ladybug,laugh,library,lightning,listen,macaroni,magic,Mercury,midnight,mirror,mountain,movie,music,natural,ocean,octagon,octopus,orange,ordinary,paradox,parallelogram,piano,pizza,playground,purple,puzzle,quickly,quiet,raspberry,rectangle,safety,sandwich,school,scientific,seesaw,shadow,shampoo,shoulder,solar system,sorry,spaghetti,special,splash,square,squirrel,stomach,sunrise,surprise,teacher,thunderstorm,tissue,toothbrush,tractor,trailer,triangle,tricycle,twilight,ultramarine,umbrella,uncle,vacuum,vegetable,violet,violin,volcano,watch,watermelon,white,yellow,yogurt,zebra".replace(/, /g, ',').split(',')
    },
    {
      name: 'Days, Months, Numbers',
      words: "Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday,January,February,March,April,May,June,July,August,September,October,November,December,one,two,three,four,five,six,seven,eight,nine,ten,eleven,twelve,thirteen,fourteen,fifteen,sixteen,seventeen,eighteen,nineteen,twenty".split(',')
    },
    {
      name: '',
      words: "classified,missive,coverup,resulting,unintentional,collateral,consequences,mass,extinction,imminent".split(',')
    },
    {
      name: '',
      words: "await,further".split(',')
    }
  ];
  
  // combine all lists
  //lists.unshift({
    //name: 'all',
    //words: [].concat.apply([], $.map(lists, function(list){ return list.words; }))
  //});
  
  // echo sorted list to console
  //console.log(Array.prototype.sort.apply(lists[6].words, [function (a, b) {
    //return a.toLowerCase().localeCompare(b.toLowerCase());
  //}]).join(','));
  
  var activeListIndexes;
  var activeLists;
  var listTotalLength;
  
  var history;
  var historyLimit;
  var historyPosition;
  
  listSelect([6,7]);
  //listSelect([8]);
  //listSelect(); // select all lists
  
  var wordCount = 0;
  
  var maxFontSize = 200; // starting value, changed on window resize
  
  // collection of fonts to use and associated values for line-height calculations
  var fonts = [
    {
      fontClass: 'fontFamily-AverageSans',
      lineHeightFactor: .875
    },
    {
      fontClass: 'fontFamily-EBGaramond',
      lineHeightFactor: .9
    }
  ];
  var fontIndex = 1; // which font from above array to use
  
  var edgePanelHeightPercentage = 7.5; /* how much of screen height the edge panels should shrink to, can be overriden by min height below */
  var edgePanelMinHeightPixels = 40; /* should be roughly same as line height of panel label */

  var sizeWatch = [];
  







  
  

  function listSelect(listIndexes){
    if (!listIndexes){
      listIndexes = [];
      for (var i = 0; i < lists.length; i++){
        listIndexes.push(i);
      }
    }
    activeListIndexes = listIndexes;
    activeLists = [];
    listTotalLength = 0;
    _.each(activeListIndexes, function(index){ activeLists.push(lists[index]); listTotalLength += lists[index].words.length; });
    
    history = [];
    //historyLimit = Math.floor(listTotalLength / 2); // how many unique words before allowing a repeat; if this is >= list length, sequence will be the same when looping
    historyLimit = listTotalLength; // set limit to list length to ensure no repeats until all words are traversed - HOWEVER, upon looping, all words will be in exactly the same order
    historyPosition = 0;
  }

  // randomly get word from word list
  function getWord(){
    if (historyPosition > 0){
      $('.panelWord').addClass('inHistory');
      historyPosition--;
      return activeLists[history[historyPosition][0]].words[history[historyPosition][1]];
    }
    else {
      $('.panelWord').removeClass('inHistory');
    }

    wordCount++;
    if (wordCount == 24){
      //listSelect([9]);
    }
    else if (wordCount == 6){
      //listSelect([8]);
    }
    
    var listIndex, wordIndex;
    var i = 0; // how many times are we looping before finding a number not in the history?
    do {
      listIndex = Math.floor(Math.random() * (activeLists.length));
      wordIndex = Math.floor(Math.random() * (activeLists[listIndex].words.length));
      i++;
    } while (_.find(history, function(item){ return item[0] == listIndex && item[1] == wordIndex; }));
    
    // remove oldest index from end of history
    if (history.length >= Math.min(listTotalLength - 1, historyLimit)){
      history.pop(1);
    }
    
    // add this index to beginning of history
    history.unshift([listIndex, wordIndex]);
    
    // show word list name
    $('.panelWordDetails').text(activeLists[listIndex].name);
    
    return activeLists[listIndex].words[wordIndex];
  }
  
  // adjust font size to fit within container
  function fitWord (el){
    // resize text in word panel
    maxFontSize = Math.floor(el.height() * .66);
    var lineHeight = Math.floor(el.height() * fonts[fontIndex].lineHeightFactor);
    el.css('line-height', lineHeight + 'px');
    el.quickfit({max: maxFontSize});
  }
  
  // word switch procedure
  function nextWord(){
    $('.word')
      .clearQueue()
      .fadeTo(200, 0,
        function(){
          $('.word').text(getWord())
          fitWord($('.word'));
          $('body').removeClass('loading');
        })
      .fadeTo(200, 1);
  }
  
  // go back in history
  function previousWord(){
    historyPosition = Math.min(historyPosition + 2, history.length);
    nextWord();
  }
  
  // determine 
  function getPanelDistancePercentage(){
    var windowHeight = $(document).height();
    var panelMinHeight = Math.max(windowHeight * edgePanelHeightPercentage / 100, edgePanelMinHeightPixels);
    return 100 - (panelMinHeight / windowHeight * 100);
  }
  
  // touch+click support for interactive elements (buttons, links, etc.)
  function touchClick(selector, action){
    // flag this as touch-enabled device, to prevent registering clicks on elements where touch events will be processed
    // otherwise clicks will be duplicates
    $('body').on('touchstart', selector, function(e) {
      $(this).addClass('touching');
    });

    // if a touch event has already occurred, abort click handler
    $('body').on('click', selector, function(){
      if ($(this).hasClass('touching')){
        e.preventDefault();
        return false;
      }
      else {
        action();
      }
    });

    // process touch events if available
    $('body').on('touchend', selector, function(e){
      setTimeout(function(){ // perform after a timeout to allow slower (mobile) devices to process *after* click event (which is slightly delayed)
        $(this).removeClass('touching'); // remove after each touch completes, in case this device support both mouse and touch and the user alternates between both
      }, 500);
      action();
    });
  }
  
  // custom element resize handler
  // checks width and height of el every interval ms, and executes action if either dimension has changed
  function onResize(el, action, interval){
    interval = interval || 25;
  
    // add unique tracking id to this element
    el.attr('sizeWatchId', sizeWatch.length);
    
    var watch = {
      el: el,
      width: el.width(),
      height: el.height(),
      action: action,
      
      timeoutId: setInterval(function(){
        var id = el.attr('sizeWatchId');
        if (sizeWatch[id]){
          var newWidth = el.width(), newHeight = el.height();
          
          // if current dimensions don't match most recently saved dimensions, save new dimensions and execute action
          if (newWidth != sizeWatch[id].width || newHeight != sizeWatch[id].height){
            sizeWatch[id].width = newWidth;
            sizeWatch[id].height = newHeight;
            action();
          }
        }
      }, interval)
    };
    
    // save this object for later retrieval
    sizeWatch.push(watch);
  }
  
  // stop custom resize handler for passed element
  function clearResize(el){
    var id = el.attr('sizeWatchId');
    
    if (sizeWatch[id]){
      clearInterval(sizeWatch[id].timeoutId);
    }
  }
  
  function panelTopExpand(){
    $('.panelTop').clearQueue().animate({bottom: '25%'}, function(){ $('.panelTop').addClass('expanded'); });
    
    $('.panelWord').clearQueue().animate({
      top: '75%',
      bottom: '5%',
      'border-radius': '10px 10px 0 0'
    });
    
    $('.panelBottom').clearQueue().animate({top: '95%'}).removeClass('expanded');
  }
  
  function panelBottomExpand(){
    $('.panelBottom').clearQueue().animate({top: '25%'}, function(){ $('.panelBottom').addClass('expanded'); });
    
    $('.panelWord').clearQueue().animate({
      bottom: '75%',
      top: '5%',
      'border-radius': '0 0 10px 10px'
    });
    
    $('.panelTop').clearQueue().animate({bottom: '95%'}).removeClass('expanded');
  }
  
  function panelRestore(){
    $('.panelWord').clearQueue().animate({
      top: '15%',
      bottom: '15%',
      'border-radius': '10px'
      //height: '400px'
    });
    
    $('.panelTop').clearQueue().animate({'bottom': getPanelDistancePercentage() + '%'}, function(){ $('.panelTop').removeClass('expanded'); });
    
    $('.panelBottom').clearQueue().animate({'top': getPanelDistancePercentage() + '%'}, function(){ $('.panelBottom').removeClass('expanded'); });
  }
  
  







  touchClick('.panelWord, .background', function(){
    nextWord();
  });
  
  touchClick('.panelTop', function(){
    if (!$('.panelTop').hasClass('expanded')){ // top panel not currently expanded
      panelTopExpand();
    }
    else { // top panel already expanded, so hide it and restore normal view
      panelRestore();
    }
  });
  
  touchClick('.panelBottom', function(){
    if (!$('.panelBottom').hasClass('expanded')){ // top panel not currently expanded
      panelBottomExpand();
    }
    else { // top panel already expanded, so hide it and restore normal view
      panelRestore();
    }
  });
  
  // on window resize, .panelWord is resized (according to css rules)
  // adjust font size and line-height accordingly
  $(window).resize(function(){
    // resize shrunken edge panels
    if (
      !$('body').hasClass('loading')
      &&
      !$('.panelTop').hasClass('expanded')
      &&
      !$('.panelBottom').hasClass('expanded')
    ){
      $('.panelTop').clearQueue().animate({'bottom': getPanelDistancePercentage() + '%'});
      $('.panelBottom').clearQueue().animate({'top': getPanelDistancePercentage() + '%'});
    }
    
    fitWord($('.word'));
  });
  
  // no div resize support in jQuery,
  //   and ba-resize plugin doesn't seem to work...
  //$('.panelWord').resize(function(){
    //console.log('panelWord resize');
    //fitWord($(this));
  //});
  
  onResize($('.panelWord'), function(){
    fitWord($('.word'));
  });
  
  
  
  // keyboard keyCodes
  var keys = {
    'space': 32,
    'left': 37,
    'right': 39,
    'up': 38,
    'down': 40,
    'esc': 27
  };
  
  // process keyboard input
  $(document).keydown(function(e){
    //console.log('keydown ' + e.keyCode);
    switch (e.keyCode) {
      case keys.space:
      case keys.right:
        nextWord();
        //e.preventDefault();
        //return false;
        break;
        
      case keys.left:
        previousWord();
        break;
        
      case keys.up:
        if ($('.panelBottom').hasClass('expanded')){
          panelRestore();
        }
        else {
          panelTopExpand();
        }
        break;
        
      case keys.down:
        if ($('.panelTop').hasClass('expanded')){
          panelRestore();
        }
        else {
          panelBottomExpand();
        }
        break;
    }
  });
  

  




  
  
  // trigger resize handler once on page load
  $(window).triggerHandler('resize');

  // make sure panelWord and quickfit helper element use same font
  $('.panelWord, #meassure') 
    .removeClass(function(index, css){
      return (css.match (/\bfontFamily-\S+/g) || []).join(' ')
    })
    .addClass(fonts[fontIndex].fontClass);
    
  // do initial animation
  $('.panelWord')
    .removeClass(function(index, css){ return false; })
    .addClass(fonts[fontIndex].fontClass)
    .fadeTo(1000, 1, function(){
      $('.word')
        .delay(2000)
        .fadeTo(400, 0,
          function(){
            $('.word').text('touch to begin');
            fitWord($('.word'));
          })
        .fadeTo(400, 1);
      });
  
  $('.panelTop').delay(750).fadeTo(200, 1).delay(500).animate({'bottom': getPanelDistancePercentage() + '%'}); //, function(){ $('body').removeClass('loading'); });
  $('.panelBottom').delay(1000).fadeTo(200, 1).delay(500).animate({'top': getPanelDistancePercentage() + '%'});

  
  
});

</script>

</body>

</html>
